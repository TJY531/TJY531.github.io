<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>论文学习 | 好好学习，天天向上</title><meta name="author" content="星星之火"><meta name="copyright" content="星星之火"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Attention U-Net:摘要 提出新的关住门（AG）模型，  IHA-Unet介绍 （First of all,as the complexity of brain structure, the feature of ICH is very similar to that of skull, which brings interference to  both feature extrac">
<meta property="og:type" content="article">
<meta property="og:title" content="论文学习">
<meta property="og:url" content="http://tjy531.com.cn/2023/08/22/%E8%84%91%E5%87%BA%E8%A1%80%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="好好学习，天天向上">
<meta property="og:description" content="Attention U-Net:摘要 提出新的关住门（AG）模型，  IHA-Unet介绍 （First of all,as the complexity of brain structure, the feature of ICH is very similar to that of skull, which brings interference to  both feature extrac">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/waibaowebsite.jpg">
<meta property="article:published_time" content="2023-08-22T12:35:39.000Z">
<meta property="article:modified_time" content="2023-09-20T14:37:55.816Z">
<meta property="article:author" content="星星之火">
<meta property="article:tag" content="有利的情况和主动的恢复，产生于再坚持一下的努力之中">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/waibaowebsite.jpg"><link rel="shortcut icon" href="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/waibaowebsite.jpg"><link rel="canonical" href="http://tjy531.com.cn/2023/08/22/%E8%84%91%E5%87%BA%E8%A1%80%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 星星之火","link":"链接: ","source":"来源: 好好学习，天天向上","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '论文学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-20 22:37:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = 'hidden';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}

preloader.initLoading()
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/waibaowebsite.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="好好学习，天天向上"><span class="site-name">好好学习，天天向上</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">论文学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-22T12:35:39.000Z" title="发表于 2023-08-22 20:35:39">2023-08-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-20T14:37:55.816Z" title="更新于 2023-09-20 22:37:55">2023-09-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="论文学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/08/22/%E8%84%91%E5%87%BA%E8%A1%80%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/#post-comment"><span class="waline-comment-count" data-path="/2023/08/22/%E8%84%91%E5%87%BA%E8%A1%80%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Attention-U-Net"><a href="#Attention-U-Net" class="headerlink" title="Attention U-Net:"></a>Attention U-Net:</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><ul>
<li>提出新的关住门（AG）模型，</li>
</ul>
<h1 id="IHA-Unet"><a href="#IHA-Unet" class="headerlink" title="IHA-Unet"></a>IHA-Unet</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li><u>（First of all,as the complexity of brain structure, the feature of ICH is very similar to that of skull, which brings interference to  both feature extraction and segmentation.）</u>ICH 的特征与颅骨的特征非常相似，这会给特征的提取和分割带来干扰。</li>
<li><u>(Additionally, the location and size of cerebral hemmorrhage lesions on CT images are varible,which further reduces the accuracy of segmentation, for example, the erea of intraventricular hemorrhage is long strip and slightly low density, while the one of brainstem hemorrhage is very smal</u>l.) 脑出血病灶在CT图像上的位置和大小不一，这引入降低了分割的准确性，比如脑室内出血区域呈长条形，密度略低，而脑干出血区域很小。并且，ICH种类繁多，很难构建一个能处理不同规模ICH的深度学习模型。</li>
<li><u>Moreover, due to continuous convolutions, a puny cerebral hematoma(early ICH) tends to be lightly lost and difficult to recover</u>.(持续的卷积，微小的脑血肿容易丢失且难以恢复)</li>
<li><u>there is a large imbalance between foreground and background pixels, which further reduces the accuracy of segmentation</u>.(前景和背景像素之间存在较大的不平衡，这也会降低分割的准确性)，在作者使用的公开数据集中，大部分的血肿面积占整个图像的比例不超过3%。</li>
<li><u>In order to address the aforementioned issues, in this paper, a novel end-to-end model is developed, which can work well on tiny intracerebral hemorrhage segmentation</u>.(为了解决上述问题，本文提出了一种新颖的端到端脑出血分割模型，该模型能够很好低进行微小脑出血分割)</li>
<li><strong><u>In response to the loss of information on tiny hemaomas, we introduce the Residual Hybrid Atrous Convolution(RUAC) strategy to integrate atrous convolution.</u> (针对微小血肿信息丢失问题，引入残差混合亚光卷积对亚光卷积进行积分)</strong> ，<strong>Generally speaking ,in the shallower layers, the larger the receptive field is, the sparser the convolution kernel is , it cannot cover critical local information and consequently a great part of the detailed information diminishes, which is very detrimental for tiny intracerebral hemorrhage segmentation.(在较浅的层中，感受野越大，卷积核越稀疏，无法覆盖关键的局部信息，从而导致很一部分详细信息衰减，这对微小脑出血分割是十分不利的。)</strong>  <strong>Thus, by configuring RHAC modules with different atrous rates at different encoder stages, multi-scale contextual information can be aggregted without loss of resolution.(因此，通过在不同的编码区阶段配置具有不同属性率的RHAC模块，可以在不损失分辨率的情况下聚合多尺度上下文信息)</strong> <strong>Specifically,for shallow stages, we set  a smaller reception field,compared with deep ones.(具体来说，在浅层阶段，设置了一个较小的接受场，而不是在深层阶段）</strong> <strong>Besides, the multi-object optimization function is utilized as the loss during training process to handle the imbalance problem of the imbalance problem of the foreground and background pixels.(在训练过程中，利用多目标优化函数作为损失来处理前景和背景像素的不平衡问题) Furthermore, in order to facilitate better segmentation performance of intracranial hemorrhage, we also employ intermediate supervision with a lightweight heed.(为了更好地分割颅内出血，还采用了轻量级头部的中间监督)</strong></li>
</ul>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagefortjy.oss-cn-shenzhen.aliyuncs.com/img/image-20230824164544764.png"/>

<p><strong>We employ the modified U-shape structure to improve segmentation performance, where pretained ResNet-34 is exploited as the encoder backbone.</strong> </p>
<p><strong>Before information fusion, Residual Hybrid Atros Convolution(RHAC) strategy is adopted to gather multiscale context information of the objects.</strong></p>
<p><strong>In addition to the first stage of the encoder, RHAC modules with different configurations are placed at each stage of the encoder as the network deepens.</strong></p>
<p><strong>Then, a spatial context information extractor is utilized to capture spatial information of local and global features.</strong></p>
<p><strong>UItimately, the final result is acquired by inserting an attention mechanism with intermediate supervision in the decoding stage to recover the resolution of feature map.</strong></p>
<p>IHA-Net 结构：采用改进的U形结构来提高分割性能，利用预训练的ResNet-34 作为编码器主干。在信息融合之前，采用残差混合属性卷积策略收集目标的多尺度上下文信息，除了编码器的第一级外，随着网络的加深，在编码器的每一级都放置了不同配置的RHAC模块，利用空间上下文信息提取器捕获局部和全局特征的空间信息。最后，通过在解码阶段插入具有中间监督的注意力机制来恢复特征映射的分辨率，从而获得最终结果。</p>
<p><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagefortjy.oss-cn-shenzhen.aliyuncs.com/img/202308241750688.png" alt="image-20230824175059643">     血肿大小的分布，其中每个血肿在每组中的比例相对平衡。横轴表示血肿区域与图像区域的比值。纵轴表示一定大小的血肿样本与整个样本的比例</p>
<h3 id="x3D-x3D-A-Residual-Hybrid-Atrous-Convolution-module-x3D-x3D"><a href="#x3D-x3D-A-Residual-Hybrid-Atrous-Convolution-module-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;A. Residual Hybrid Atrous Convolution module&#x3D;&#x3D;"></a>&#x3D;&#x3D;A. Residual Hybrid Atrous Convolution module&#x3D;&#x3D;</h3><p><strong>Since the cerebral hemorrhage data used for training and test many come from the patients with different types of ICH at different stages, there may be different scales of ICH regions.(来自不同类型、不同阶段的脑出血患者，脑出血区域可能有不同的尺度)</strong> **Considering that the continuous stacked down-sampling in the encoder  stages will lead to a severe loss of relevant detailed information, small object information cannot be reconstructed.(考虑到编码器阶段的连续叠加下采样会导致相关详细信息的严重丢失，小目标信息无法重构)**，Hence, how to dwindle the loss of crucial information on small objects has become an important issue we need to address.To mitigate the influe-nce of the above problems, we propose the Residual Hybrid Atrous Convolution(-RHAC) module to further capture multi-scale context features for intracanial he-morrhage of different sizes.<strong>RHAC block is integrated by several hybrid atrous co-nvolutional layers, max-pooling layers and residual connections. （RHAC块由多个混合属性卷积层、最大池化层和残差连接组成）</strong> </p>
<p><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagefortjy.oss-cn-shenzhen.aliyuncs.com/img/202308241837033.png" alt="image-20230824183747982"></p>
<p>four parallel branches ,three of which are equipped with convolutions with diferent diated ratios, and one branch with the max-pooling layer.A 1x1 convolution is added after convolution of each branch to realize integration of information, and then the rectified linear unit(ReLU) is used as the activation function. Moreover, we utilize residual connections to optimize network.</p>
<p>​	With the depth of networks increasing, the resolution of feature maps gradually decreases, resulting in information contained in the shallow network sparser.Therefore, it is necessary to use a larger receptive fielf to aggregate spatial  information.**Compared with conventional convolution, the noteworthy of atrous convolution is the expansion of the receptive field without alteringf feature maps resolution, which is helpful to reduce the loss of semantic information to some extent.(在不改变特征图分辨率的情况下扩展了感受野，这在一定程度上有助于减少语义信息的损失)**，However, only using the convolution with large dilated rate is not benefiical to the segmentation of small objects.(仅使用膨胀率较大的卷积不利于小目标的分割)，In order to reduce the loss of the internal data and spatial hierarchical information of small objects, we configure RHAC modules with different atrous rates  in the different stages of encoders.<strong>To be specific,a relatively small receptive field is formed by configuring a smaller atrous rate in the shallow layer, and a larger atrous rateis configured in the deep layer to yield a relatively large receptive  field.(浅层配置较小的属性率形成相对较小的感受野，深层配置较大的属性率形成相对较大的感受野)<strong>，</strong>In this way, the information of small targets in the shallow layer is less likely to be lost.RHAC block ,more abstract features of different sizes for hemorrhage regions are extracted and multi-scale context information is fully captured, enhancing local information prediction.(提取出血区域更多不同大小的抽象特征，充分捕获多尺度上下文信息，增强局部信息预测)</strong> </p>
<h3 id="x3D-x3D-B-Spatial-Context-Information-Extractor-x3D-x3D"><a href="#x3D-x3D-B-Spatial-Context-Information-Extractor-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;B. Spatial Context Information Extractor&#x3D;&#x3D;"></a>&#x3D;&#x3D;B. Spatial Context Information Extractor&#x3D;&#x3D;</h3><p><strong>From above modules, more semantic information of shallow features is introduced. To further embed more spatial inforamtion in the deep features, we utilize like spatial pyramid pooling for accurate ICH region segmentation from the CE-Net model .(从以上模块中引入了更多浅层特征的语义信息，为了进一步在浅层特征中嵌入更多的空间信息，利用空间金字塔池从CE-Net 模型中精准分割ICH 区域)</strong> <strong>The same feature map is pooled in parallel with different sizes, so that the feature map of different sizes can be obtained. Then low-resolution feature map is upsampled directly via bilinear interpolation to obtain a feature map with the same resolution as the original feature map. Finally, the different levels of features are concatenated together as a final pyramid pooling global feature.(对相同的特征图进行不同大小的并行池化，得到不同大小的特征图，对低分辨率特征图直接进行双线性插值上采样，得到与原特征图分辨率相同的特征图，最后，将不同级别的特征连接在一起，形成最终的金字塔全局特征)</strong> 为了减少参数，池化后进行1x1 卷积，用于捕获空间上下文信息的感受野大小分别为2x2,3x3,5x5,6x6.<strong>This module enables the fusion of local and global features, enriching the expression capability of feature maps and facilitating the segmentation of hematoma regions with  different sizes in images.该模块实现了局部和全局特征的融合，丰富了特征图的表达能力，便于对图像中不同大小的血肿区域进行分割。</strong></p>
<h3 id="x3D-x3D-C-Attention-Mechanism-x3D-x3D"><a href="#x3D-x3D-C-Attention-Mechanism-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;C. Attention Mechanism&#x3D;&#x3D;"></a>&#x3D;&#x3D;C. Attention Mechanism&#x3D;&#x3D;</h3><p>Apart from designing various networks architectures,the mechanism named attention, which is motivated by the fact that human recognize what we see not by a full scene but firstly focus on the most important objects has widely been applied in CNN architectures and obtained splendid performance.**As a simple but effective structure that improves the representational power and attention of relevant features by suppressing non-important features, among these attention mechanisms, channel-wise attention and spatial-wise attention inherit the capability of capturing inter relationship to denote which part of features is more considered by CNN.(作为一种简单而有效的结构，通过抑制非重要特征来提高相关特征的表征能力和关注度，在这些注意机制中，通道型注意和空间型注意继承了捕捉相互关系的能力，以表示CNN更关注哪一部分特征)**，Likewise,these two attention mechanisms attempt to emphasize input features by separately placing channel-wise and spatial-wise attention modules where the attention output is rescored to input feature with element-wise multiplication. </p>
<p><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagefortjy.oss-cn-shenzhen.aliyuncs.com/img/202308242217452.png" alt="image-20230824221720373"></p>
<p><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagefortjy.oss-cn-shenzhen.aliyuncs.com/img/202308242220455.png" alt="image-20230824222015418"></p>
<h3 id="x3D-x3D-D-Intermediate-Supervision-x3D-x3D"><a href="#x3D-x3D-D-Intermediate-Supervision-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;D. Intermediate Supervision&#x3D;&#x3D;"></a>&#x3D;&#x3D;D. Intermediate Supervision&#x3D;&#x3D;</h3><p>When training the deep network, with the update of the model parameters using the gradient descent method, the loss of the output layer is greatly reduced by multiple layers, namely, the gradient vanishing occurs.** To solve this problem, we calculate the output loss at the soecified decoder stage, and sum up these loss values when updating the weights.(计算指定解码阶段的输出损失，并在更新权值时将这些损失值相加)**，This method guarantees the normal update of the parameters and suppresses the gradient vanishing problem.<strong>Among them, the calculated losses in these network layers become auxiliary losses.The purpose of intermediate supervision is to allow more adequate training of the shallow layers to avoid gradient disappearance and slow convergence.(这些网络层的计算损耗成为辅助损耗，中间监督的目的是额为了对浅层进行更充分得到训练，以避免梯度消失和收敛缓慢)</strong> <strong>By using additional intermediate supervision signals to help intensify tiny hematoma features and prevent information loss in deep layers(通过使用额外的中间监督信号来帮助强化微小的血肿特征，防止深层的信息丢失)</strong></p>
<h3 id="x3D-x3D-E-Multi-object-function-for-joint-optimization-x3D-x3D"><a href="#x3D-x3D-E-Multi-object-function-for-joint-optimization-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;E. Multi-object function for joint optimization&#x3D;&#x3D;"></a>&#x3D;&#x3D;E. Multi-object function for joint optimization&#x3D;&#x3D;</h3><p><strong>in our dataset, due to the proportion of hematomas in the images is much smaller than the background, the positive and negative classes of samples are extremely unbalanced.In this situation, the ordinarily used pixel-by-pixel cross-entropy loss function may give rise the training procedure dominated by the negative class, thereby  reducing the effectiveness of the network.（血肿比例远远小于背景，正负类样本极不平衡）使用逐像素交叉熵损失函数可能会产生负类主导的训练过程，从而降低网络的有效性）</strong>，The focal object optimization function was originally used in the field of object detection to solve the sample imbalance problem by <strong>reducing the weights  of a large number of negative samples in the training process.</strong></p>
<p><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagefortjy.oss-cn-shenzhen.aliyuncs.com/img/202308251246319.png" alt="image-20230825124612217"></p>
<h1 id="Directional-Connectivity-based-Segmentation-of-Medical-Images"><a href="#Directional-Connectivity-based-Segmentation-of-Medical-Images" class="headerlink" title="Directional Connectivity-based Segmentation of Medical Images"></a>Directional Connectivity-based Segmentation of Medical Images</h1><h2 id="摘要-1"><a href="#摘要-1" class="headerlink" title="摘要"></a>摘要</h2><p>提出观点：生物标记物分割中的解剖一致性对许多医学图像分析任务至关重要，实现解剖一致性的一个有用的方式是将像素连通性纳入像素间关系模型；以往的连通性建模工作忽略了潜在空间中丰富的通道方向信息，作者证明了从共享潜在空间中有效地纠缠方向子空间可以显著增强基于连接的网络中的特征表示；作者提出一种用于分割的方向连接建模方案，该方案可以解耦、跟踪和利用整个网络的方向信息。代码：<strong><a target="_blank" rel="noopener" href="https://github.com/Zyun-Y/DconnNet">https://github.com/Zyun-Y/DconnNet</a></strong></p>
<h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>图像中的解剖一致性可以用拓扑属性来表示，例如像素连通性和邻接性。基于图的方法通过直接建模像素或区域之间的相互信息，长期以来被用于纠正拓扑和几何误差，但这些技术通常依赖于人工定义的先验，不易推广到各种各样的应用中。</p>
<p>​		典型的分割网络将问题建模为纯像素分类任务，并使用分割掩码作为唯一的标签。但是，这种逐像素建模方案是次优的，因为它没有直接利用像素间关系和几何属性。因此，这些模型在预测中可能导致低空间相干性（即对具有相似空间特征的相邻像素的预测不一致）。特别是，当应用与高噪声&#x2F;伪像的医疗数据时，较低的空间一致性可能导致拓扑问题。长期以来，像素连通性的概念被用于确保数字图像中分离和连通性的基本拓扑对偶性。使用连通性掩码作为训练标签有几个优点：<strong>在问题建模方面，使用连通性掩码本质上将问题从逐像素分类更改为连通性预测，从而对感兴趣的像素之间的拓扑表示进行建模和增强；在标签表示方面，连接掩码在三个方面提供了更多的信息：首先，连接掩码在像素的连接之间存储分类信息，并且具有像素间关系感知；其次，稀疏表示边缘像素；第三，它包含了丰富的定向信息渠道。因此，用连通性掩模训练的网络在潜空间中既有分类特征（通过连通性来体现），也有方向性特征，每一种特征都形成了特定的次替空间。</strong></p>
<p>在以往的研究中，这两组特征是通过共享的网络路径同时学习的，这可能导致潜在空间高度耦合，并引入冗余。另外，从共享潜在空间中有效分离有意义的子空间已被证明可以有效地解释特征之间的依赖性&#x2F;独立性。</p>
<p><strong>受潜在空间解纠缠思想启发，作者提出一种新的基于方向连通性的分割网络，从共享潜在空间中解纠缠方向子空间，并利用提取的方向特征来增强整体数据表示。解缠过程是由一种称为子路径方向激励(SDE)的基于子路径切片的模块进行的。利用具有两个自顶向下交互解码流的交互式特征空间解码器(IFD)，以从粗到精的方式应用基于方向的特征增强。最后，我们提出了一种新的基于标签大小分布的加权方案，缓解了医疗数据集中常见的数据不平衡问题。通过对不同公共医学图像分析基准的实验，证明了DconnNet相对于其他最先进方法的优越性。</strong></p>
<h2 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h2><p><strong>像素连通性</strong></p>
<p>在拓扑学中，像素连通性描述了相邻像素之间的相互关系。在深度学习中的图像分割中，基于连通性的分割网络使用连通性掩码作为标签，定义为8通道掩码，每个通道表示原始图像上的一个像素是否是与其相邻像素在特定方向上属于同一兴趣类。</p>
<p><strong>潜在空间</strong></p>
<p><strong>在这项工作中，我们利用连通性掩模的固有特性，提出了一种简单而有效的基于子路径切片的方法来从共享潜在空间中解纠缠方向子空间，随后用T-SNE可视化演示了我们解纠缠过程的有效性</strong></p>
<h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h2><p>由于不同像素类别和方向之间的连通性，基于连通性的网络潜在空间中存在两组特征:分类方向。每一组特征在潜在空间中形成其特定的子空间。在单路径连接网络中，这两个子空间是高度耦合的(图2)，从而产生低判别特征。我们证明了有效的解纠缠和方向空间的有效利用可以增强连通性模型中的整体特征表示。</p>
<p>在连接掩码中，不同的通道表示像素连接的不同方向。因此，随着网络的深入，它自然会在通道之间存储定向信息。基于这一特性，可以通过通道操作捕获和操纵方向特征。具体来说，我们提出SDE从潜在空间中解出通道方向特征，然后提出IFD提取不同层的方向嵌入，并使用它们以自关注的方式增强整体特征表示。</p>
<p>DconnNet的总体结构如图所示。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://tjy531.com.cn">星星之火</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://tjy531.com.cn/2023/08/22/%E8%84%91%E5%87%BA%E8%A1%80%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/">http://tjy531.com.cn/2023/08/22/脑出血论文学习/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://tjy531.com.cn" target="_blank">好好学习，天天向上</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/waibaowebsite.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/20/%E5%9B%BE%E5%83%8F%E5%88%86%E5%89%B2%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" title="图像分割论文学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">图像分割论文学习</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/31/MT-UNet%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" title="MT-UNet论文学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MT-UNet论文学习</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/waibaowebsite.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">星星之火</div><div class="author-info__description">一万年太久，只争朝夕</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/TJY531"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/TJY531" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:3187937600@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">努力提升自己</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Attention-U-Net"><span class="toc-number">1.</span> <span class="toc-text">Attention U-Net:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-number">1.1.</span> <span class="toc-text">摘要</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IHA-Unet"><span class="toc-number">2.</span> <span class="toc-text">IHA-Unet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-A-Residual-Hybrid-Atrous-Convolution-module-x3D-x3D"><span class="toc-number">2.2.1.</span> <span class="toc-text">&#x3D;&#x3D;A. Residual Hybrid Atrous Convolution module&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-B-Spatial-Context-Information-Extractor-x3D-x3D"><span class="toc-number">2.2.2.</span> <span class="toc-text">&#x3D;&#x3D;B. Spatial Context Information Extractor&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-C-Attention-Mechanism-x3D-x3D"><span class="toc-number">2.2.3.</span> <span class="toc-text">&#x3D;&#x3D;C. Attention Mechanism&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-D-Intermediate-Supervision-x3D-x3D"><span class="toc-number">2.2.4.</span> <span class="toc-text">&#x3D;&#x3D;D. Intermediate Supervision&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-E-Multi-object-function-for-joint-optimization-x3D-x3D"><span class="toc-number">2.2.5.</span> <span class="toc-text">&#x3D;&#x3D;E. Multi-object function for joint optimization&#x3D;&#x3D;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Directional-Connectivity-based-Segmentation-of-Medical-Images"><span class="toc-number">3.</span> <span class="toc-text">Directional Connectivity-based Segmentation of Medical Images</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%98%E8%A6%81-1"><span class="toc-number">3.1.</span> <span class="toc-text">摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">3.2.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C"><span class="toc-number">3.3.</span> <span class="toc-text">相关工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1"><span class="toc-number">3.4.</span> <span class="toc-text">方法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/25/Res2Net%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/" title="Res2Net论文阅读记录">Res2Net论文阅读记录</a><time datetime="2025-02-25T12:56:50.000Z" title="发表于 2025-02-25 20:56:50">2025-02-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/22/%E5%8D%B7%E7%A7%AF/" title="卷积">卷积</a><time datetime="2025-02-22T02:45:06.000Z" title="发表于 2025-02-22 10:45:06">2025-02-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/20/EGE-UNet/" title="EGE-UNet 论文阅读记录">EGE-UNet 论文阅读记录</a><time datetime="2025-02-20T05:30:11.000Z" title="发表于 2025-02-20 13:30:11">2025-02-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/19/h2former%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/" title="H2former论文阅读记录">H2former论文阅读记录</a><time datetime="2025-02-19T06:23:26.000Z" title="发表于 2025-02-19 14:23:26">2025-02-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/14/Camoformer%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/" title="Camoformer论文阅读记录">Camoformer论文阅读记录</a><time datetime="2025-02-14T08:44:48.000Z" title="发表于 2025-02-14 16:44:48">2025-02-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By 星星之火</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://comment.tjy531.com.cn/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, {"requiredMeta":["nick","mail"],"locale":{"placeholder":"昵称和邮箱为必填项，为了您能及时收到相关信息，请确保邮箱的正确性"}}))
  }

  const walineCSSLoad = document.getElementById('waline-css')

  if (typeof Waline === 'object') {
    walineCSSLoad ? initWaline() : getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css','waline-css').then(initWaline)
  }
  else {
    getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css','waline-css').then(() => {
      getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
    })
  }
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="https://imagfromtjy.oss-cn-shenzhen.aliyuncs.com/img/loadingwebsite.gif" data-original="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const loadWaline = () => {
      Waline.RecentComments({
        serverURL: 'https://comment.tjy531.com.cn/',
        count: 6
      }).then(({comments}) => {
        const walineArray = comments.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.insertedAt,
          }
        })
        saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
        generateHtml(walineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
    }

    if (typeof Waline === 'object') loadWaline()
    else getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(loadWaline)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="study?,study!,ok" data-fontsize="10px" data-random="true" async="async"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>